FROM ubuntu:jammy

ENV TZ=UTC

RUN ln -snf /usr/share/zoneinfo/UTC /etc/localtime && echo UTC > /etc/timezone

RUN apt-get update  ; apt install -y less
RUN groupadd -g 300 vmail; useradd -M -r -d /opt/vmail -u 300 -g vmail vmail

RUN apt-get install -y locales && echo "LANG=en_US.UTF-8" > /etc/default/locale

COPY courier-packages.tar /courier-packages.tar
RUN set -x; cd /tmp; mkdir p; cd p; tar -xf /courier-packages.tar && \
  ls ; \
  rm *web* *pop3* *mysql* *auth*pgsql* *auth*pipe* *ldap* *fax* *-dev* && \
  rm *mlm* && \
  rm /courier-packages.tar && \
  apt install -y ./*.deb && \
  rm *.deb

RUN cd /etc/authlib; sed -idist 's/^authmodulelist="authuserdb /authmodulelist="authuserdb"  #/g' authdaemonrc
COPY render-template /render-template
COPY acceptmailfor.template /acceptmailfor.template
COPY hosteddomains.template /hosteddomains.template

ENTRYPOINT ["/usr/bin/tail", "-f", "/dev/null"]
